<UserControl
    x:Class="Arqanum.Controls.UserProfileDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    IsHitTestVisible="True">

    <Grid x:Name="RootGrid"
          Background="Transparent"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          Width="400">

            <Grid>
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" MaxHeight="440" Margin="0,65,0,0">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Top" Spacing="12" >

                    <Grid Width="100" Height="100"
                        x:Name="AvatarGrid"
                        PointerEntered="AvatarGrid_PointerEntered"
                        PointerExited="AvatarGrid_PointerExited">

                        <!-- Кликабельный аватар -->
                        <Ellipse Width="100" Height="100"
                            Tapped="Avatar_Tapped">
                            <Ellipse.Fill>
                                <ImageBrush ImageSource="{Binding CurrentAccount.AvatarUrl, Mode=OneWay}" Stretch="UniformToFill"/>
                            </Ellipse.Fill>
                        </Ellipse>

                        <Button x:Name="CameraButton"
                            Width="32" Height="32"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Padding="2"
                            Visibility="Collapsed"
                            CornerRadius="16"
                            Background="#66000000"
                            BorderBrush="{x:Null}"
                            IsHitTestVisible="True">

                            <FontIcon Glyph="&#xE722;" FontSize="15"  Foreground="White"/>
                            <Button.Flyout>
                                <Flyout>
                                    <StackPanel>
                                        <Button Click="FileButton_Click" Width="100" HorizontalContentAlignment="Left" Margin="0,0,0,5">
                                            <StackPanel Orientation="Horizontal" >
                                                <FontIcon Glyph="&#xE91B;" Margin="0,0,8,0"/>
                                                <TextBlock Text="File"/>
                                            </StackPanel>
                                        </Button>

                                        <Button Click="CameraButton_Click" Width="100" HorizontalContentAlignment="Left">
                                            <StackPanel Orientation="Horizontal">
                                                <FontIcon Glyph="&#xE722;" Margin="0,0,8,0"/>
                                                <TextBlock Text="Camera"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Flyout>

                            </Button.Flyout>
                        </Button>
                    </Grid>


                    <Grid Width="320" HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xE77B;" 
                            FontSize="14"
                            VerticalAlignment="Center"
                            Margin="0,0,8,0"
                            Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"/>

                        <TextBlock Grid.Column="1"
                            Text="Name"
                            FontSize="14"
                            FontWeight="Thin"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumHighBrush}"
                            HorizontalAlignment="Left"/>

                        <TextBlock Grid.Column="2"
                            Text="{Binding FullName, Mode=TwoWay}"
                            FontSize="14"
                            FontWeight="Medium"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource SystemAccentColor}"
                            HorizontalAlignment="Right"
                            TextAlignment="Right"
                            Margin="0,0,6,0"/>

                        <Button FontFamily="Segoe MDL2 Assets"
                            Grid.Column="3"
                            Content="&#xE70F;" 
                            Padding="0"
                            FontSize="12"
                            Width="25"
                            Height="25"
                            ToolTipService.ToolTip="Edit name">
                            <Button.Flyout>
                                <Flyout Placement="Bottom" x:Name="UpdateFullNameFlyout">
                                    <StackPanel Padding="12" MinWidth="240" Spacing="12">
                                        <TextBox Header="First Name"
                                            x:Name="FirstNameTextBox"
                                            Text="{Binding CurrentAccount.FirstName, Mode=OneWay}"
                                            MaxLength="32"/>

                                        <TextBox Header="Last Name"
                                            x:Name="LastNameTextBox"
                                            Text="{Binding CurrentAccount.LastName, Mode=OneWay}" 
                                            MaxLength="32"/>

                                        <TextBlock x:Name="ErrorTextBlock"
                                            Foreground="Red"
                                            Visibility="Collapsed"
                                            Text="Failed to update name."/>


                                        <Grid>
                                            <Button x:Name="SaveFullNameButton"
                                                Content="Save"
                                                HorizontalAlignment="Right"
                                                Foreground="White"
                                                Click="SaveFullNameButton_Click"/>

                                            <ProgressRing x:Name="SaveProgressRing"
                                                Width="20"
                                                Height="20"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                IsActive="False"
                                                Visibility="Collapsed"/>
                                        </Grid>
                                    </StackPanel>
                                </Flyout>

                            </Button.Flyout>
                        </Button>

                    </Grid>
                    <Grid Width="320" HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xE910;" 
                            FontSize="14"
                            VerticalAlignment="Center"
                            Margin="0,0,8,0"
                            Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"/>

                        <TextBlock Grid.Column="1"
                            Text="Username"
                            FontSize="14"
                            FontWeight="Thin"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumHighBrush}"
                            HorizontalAlignment="Left"/>

                        <TextBlock Grid.Column="2"
                            Text="{Binding CurrentAccount.Username}"
                            FontSize="14"
                            FontWeight="Medium"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource SystemAccentColor}"
                            HorizontalAlignment="Right"
                            TextAlignment="Right"
                            Margin="0,0,6,0"/>
                        <Button FontFamily="Segoe MDL2 Assets"
                            Grid.Column="3"
                            Content="&#xE8C8;" 
                            FontSize="14"
                            Padding="4"
                            Click="CopyUsername_Click"
                             Margin="0,0,6,0"
                            ToolTipService.ToolTip="Copy username"/>
                        
                        <Button FontFamily="Segoe MDL2 Assets"
                            Grid.Column="4"
                            Content="&#xE70F;" 
                            Padding="0"
                            FontSize="12"
                            Width="25"
                            Height="25"
                            ToolTipService.ToolTip="Edit username">
                            
                            <Button.Flyout>
                                <Flyout Placement="Bottom">
                                    <StackPanel Padding="12" MinWidth="240" Spacing="12">
                                        <TextBox Header="Username"
                                            Text="{Binding CurrentAccount.Username, Mode=OneWay}" />

                                        <Button Content="Save"
                                            HorizontalAlignment="Right"
                                            Foreground="White"/>
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        
                    </Grid>
                    <Grid Width="320" HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xEA18;" 
                            FontSize="14"
                            VerticalAlignment="Center"
                            Margin="0,0,8,0"
                            Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"/>

                        <TextBlock Grid.Column="1"
                            Text="User Id"
                            FontSize="14"
                            FontWeight="Thin"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumHighBrush}"
                            HorizontalAlignment="Left"/>

                        <TextBlock Grid.Column="2"
                            Text="{Binding CurrentAccount.AccountId}"
                            FontSize="14"
                            FontWeight="Medium"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource SystemAccentColor}"
                            HorizontalAlignment="Right"
                            TextAlignment="Right"
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="NoWrap"
                            ToolTipService.ToolTip="{Binding CurrentAccount.AccountId}"
                            Width="200"
                            Margin="0,0,6,0"/>


                        <Button Grid.Column="3"
                            FontFamily="Segoe MDL2 Assets"
                            Content="&#xE8C8;"  
                            FontSize="14"
                            Padding="4"
                            Click="CopyUserId_Click"
                            Margin="6,0,0,0"
                            ToolTipService.ToolTip="Copy user ID"/>

                    </Grid>

                    <TextBox Text="{Binding CurrentAccount.Bio, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            AcceptsReturn="True"
                            TextWrapping="Wrap"
                            PlaceholderText="Bio"
                            FontSize="13"
                            Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"
                            BorderThickness="1"
                            Height="100"
                            Width="320" />

                    <TextBlock Text="No more than 150 characters"
                            FontSize="12"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumHighBrush}"
                            Margin="0,4,0,12" />

                </StackPanel>
                </ScrollViewer>

                <Button Width="38" Height="36"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Background="Transparent"
                        BorderThickness="0"
                        FontFamily="Segoe MDL2 Assets"
                        FontSize="16"
                        Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"
                        Content="&#xE711;" 
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Center"
                        Click="Close_Click"
                        ToolTipService.ToolTip="Close"/>

            </Grid>
    </Grid>
</UserControl>
